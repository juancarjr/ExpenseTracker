{% load widget_tweaks %}
{% load humanize %}

<!-- Defaults to flex, switches to grid in medium sized screens -->
<div class="flex flex-row-reverse md:grid md:grid-cols-6 md:gap-4" id="books-container">
  <!-- Expenses table -->
  <div class="col-span-6 overflow-x-auto">
    <table class="table">
      <thead class="text-xl text-white uppercase">
          <tr>
              <th class="px-6 py-3"></th>
              {% for key in totals.keys %}
                  <th class="px-6 py-3 text-center">{{ key | capfirst }}</th>
              {% endfor %}
              <td class="text-center">TOTAL</td>
          </tr>
      </thead>
      <tbody>
          <tr>
              <th class="px-6 py-3">COMBINED EXPENSES</th>
              {% for value in totals.values %}
                  <td class="text-center">${{ value | floatformat:2 | intcomma }}</td>
              {% endfor %}
              <td class="text-center">${{ query_expense | floatformat:2 | intcomma }}</td>
          </tr>
      </tbody>
    </table>
  </div>

  <div class="col-span-5 flex items-center justify-between">
    <h1 class="mt-4 mb-6 prose text-2xl text-white flex items-center mb-4">
      <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="size-6"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"
      />
    </svg>
      Book List
    </h1>

    <h1 class="mt-4 mb-6 prose text-2xl text-white flex items-center mb-4">
      <svg 
      xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
      <a hx-get="{% url 'add_book' %}"
      hx-push-url="true"
      hx-target="#book-block"
      class="text-white no-underline cursor-pointer">
      Add Book</a>
    </h1>
  </div>

  <!-- Main Table -->
  <div class="col-span-5">
      {% if books %}

      <table class="table table-xs">
        <thead class="text-xs text-white uppercase">
          <tr>
            <th class="px-6 py-3">Title</th>
            <th class="px-6 py-3">Subtitle</th>
            <th class="px-6 py-3">Authors</th>
            <th class="px-6 py-3">Publisher</th>
            <th class="px-6 py-3">Date</th>
            <th class="px-6 py-3">Category</th>
            <th class="px-6 py-3">Expenses</th>
          </tr>
        </thead>

        <tbody>
          {% for book in books.qs %}
          <tr>
            <td>{{ book.title }}</td>
            <td>{{ book.subtitle }}</td>
            <td>{{ book.authors }}</td>
            <td>{{ book.publisher }}</td>
            <td>{{ book.published_date }}</td>
            <td>{{ book.category | capfirst}}</td>
            <td class="text-center">{{ book.distribution_expense | floatformat:2 | intcomma }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

    {% else %}
      <p class="text-2xl text-white">No books found</p>
    {% endif %}

  </div>

    <div class="col-span-1">

      <form hx-get="{% url 'books_list' %}" 
        hx-target="#books-container"
        hx-swap="outerHTML">
        <div class="mb-2 form-control">
          {{ books.form.search | add_label_class:"label text-white" }}
          {% render_field books.form.search class="select bg-gray-50 text-gray-900" %}
        </div>

        <div class="mb-2 form-control">
          {{ books.form.start_date | add_label_class:"label text-white" }}
          {% render_field books.form.start_date class="input bg-gray-50 text-gray-900" %}
        </div>

        <div class="mb-2 form-control">
          {{ books.form.end_date | add_label_class:"label text-white" }}
          {% render_field books.form.end_date class="input bg-gray-50 text-gray-900" %}
        </div>

        <div class="mb-2 form-control">
          <!-- {{ books.form.category | add_label_class:"label text-white" }} -->
          {% render_field books.form.category class="text-green-500 border-gray-300 rounded focus:ring-green-500" %}
        </div>
    
        <button class="btn btn-success">
          Filter
        </button>
    
      </form>

    </div>

  </div>